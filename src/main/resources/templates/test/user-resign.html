<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!-- <link rel="stylesheet" type="text/css" href="../css/main.css" /> -->
    <title>Login</title>
    <script src="https://unpkg.com/sweetalert2@11.10.7/dist/sweetalert2.all.min.js"></script>
    <script src="https://unpkg.com/axios@1.6.8/dist/axios.min.js"></script>
</head>

<body>
    <div id="app">
        <h3>Login</h3>
        <table>
            <tr>
                <td>userFirstname : </td>
                <td><input type="text" name="userFirstname" v-model="userFirstname"></td>
                <td><span class="error"></span></td>
            </tr>
            <tr>
                <td>userLastname : </td>
                <td><input type="text" name="userLastname" v-model="userLastname"></td>
                <td><span class="error"></span></td>
            </tr>
            <tr>
                <td>password : </td>
                <td><input type="text" name="password" v-model="password"></td>
                <td><span class="error"></span></td>
            </tr>
            <tr>
                <td>email : </td>
                <td><input type="text" name="email" v-model="email"></td>
                <td><span class="error"></span></td>
            </tr>
            <tr>
                <td>phone : </td>
                <td><input type="text" name="phone" v-model="phone"></td>
                <td><span class="error"></span></td>
            </tr>
            <tr>
                <td>birth : </td>
                <td><input type="text" name="birth" v-model="birth"></td>
                <td><span class="error"></span></td>
            </tr>
            <tr>
                <td>gender : </td>
                <td><input type="text" name="gender" v-model="gender"></td>
                <td><span class="error"></span></td>
            </tr>
            <tr>
            	<td>file : </td>
           		<td><input type="file" name="image" @change="fileSelected"></td>
            	<td><span class="error"></span></td>
            </tr>
            <tr>
                <td> </td>
                <td align="right"><button type="button" @click="resign()">Login</button></td>
            </tr>
        </table>
    </div>


    <script type="module">
        const path = "[[@{/}]]";
        import { createApp } from "https://www.unpkg.com/vue@3.3.5/dist/vue.esm-browser.prod.js"
        const app = createApp({
            data: function () {
                return {
                    userFirstname: "",
                    userLastname: "",
                    password: "",
                    email:"",
                    phone:"",
                    birth:"",
                    gender:"",
                    image:"",
                }
            },
            methods: {
                fileSelected(e) {
                    const file = e.target.files.item(0);
                    const reader = new FileReader();
                    reader.addEventListener('load', this.imageLoaded);
                    reader.readAsDataURL(file);
                 },
                 imageLoaded(e) {
                this.image = e.target.result;
                },
                resign: function () {
                    Swal.fire({
                        text: "Loading......",
                        showConfirmButton: false,
                        allowOutsideClick: false,
                    });

                    let data = {
                        "userFirstname": this.userFirstname,
                        "userLastname": this.userLastname,
                        "password": this.password,
                        "email": this.email,
                        "phone": this.phone,
                        "birth": this.birth,
                        "gender": this.gender,
                        "image":this.image
                    }
                    axios.post(path + "user/register", data).then((response) => {
                        if (response.data.success) {
                            Swal.fire({
                                text: response.data.message,
                                icon: 'success',
                                allowOutsideClick: false,
                                confirmButtonText: '確認',
                            }).then(function (result) {
                                if (result.isConfirmed) {
                                    // window.location.href = path;
                                }
                            })
                        } else {
                            this.message = response.data.message;
                            setTimeout(
                                function () {
                                    Swal.close();
                                }, 500)
                        }
                    }).catch(function (error) {
                        Swal.fire({
                            text: '失敗訊息:' + error.message,
                            icon: 'error',
                            allowOutsideClick: false,
                            confirmButtonText: '確認',
                        });
                    })
                }
            }
        })
        app.mount("#app")

    </script>

</body>

</html>